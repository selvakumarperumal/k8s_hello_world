# ==============================================================================
# Kubernetes Service - FastAPI Hello World
# ==============================================================================
#
# WHAT IS A SERVICE?
# ------------------
# A Service is an abstraction that defines a logical set of Pods and
# a policy to access them. Services enable:
#   - Stable networking (pods have dynamic IPs, services don't)
#   - Load balancing across multiple pods
#   - Service discovery via DNS
#   - Decoupling consumers from providers
#
# WHY DO WE NEED SERVICES?
# -------------------------
# Pods are ephemeral - they can be created, destroyed, moved.
# Each pod gets a unique IP, but that IP changes when pods restart.
# Services provide a stable IP and DNS name to reach pods.
#
# SERVICE TYPES:
# --------------
# | Type         | Accessibility       | Use Case                    |
# |--------------|--------------------|-----------------------------|
# | ClusterIP    | Internal only       | Microservices communication |
# | NodePort     | External via node   | Development/testing         |
# | LoadBalancer | External via cloud  | Production traffic          |
# | ExternalName | DNS alias           | External service reference  |
#
# ==============================================================================

# API version for Services (core API group, commonly called just "v1")
apiVersion: v1

# Resource type
kind: Service

# Metadata section
metadata:
  # Service name - this becomes the DNS hostname
  # Other pods can reach this at: fastapi-service.namespace.svc.cluster.local
  name: fastapi-service
  
  # Labels for the service itself
  labels:
    app: fastapi

# Service specification
spec:
  # -----------------------------------------------------------------
  # SERVICE TYPE
  # -----------------------------------------------------------------
  # ClusterIP: Creates an internal IP address for the service
  # Only accessible from within the cluster
  # 
  # To access from your local machine, use:
  #   kubectl port-forward service/fastapi-service 8000:80
  #
  type: ClusterIP
  
  # -----------------------------------------------------------------
  # SELECTOR
  # -----------------------------------------------------------------
  # Selects which pods this service routes traffic to
  # Traffic is sent to pods with matching labels
  # These labels must match the pod template labels in deployment.yaml
  selector:
    app: fastapi         # Route to pods with label "app: fastapi"
  
  # -----------------------------------------------------------------
  # PORTS
  # -----------------------------------------------------------------
  # Define how the service maps ports
  ports:
    - name: http         # Port name (optional but recommended)
      protocol: TCP      # Protocol (TCP/UDP)
      port: 80           # Port the SERVICE listens on (external)
      targetPort: 8000   # Port the CONTAINER listens on (internal)

# ==============================================================================
# TRAFFIC FLOW
# ==============================================================================
#
#   Client Request (kubectl port-forward)
#          │
#          ▼
#   localhost:8000  ────────────────────┐
#          │                            │
#          ▼                            │ You are here
#   Service (fastapi-service:80)  ──────┤ (port-forward
#          │                            │  bypasses this)
#          ▼                            │
#   kube-proxy (load balances)          │
#          │                            │
#          ├────────────┬───────────────┘
#          ▼            ▼
#      Pod 1:8000   Pod 2:8000
#
# ==============================================================================
# DNS NAMES
# ==============================================================================
#
# Within the same namespace:
#   curl http://fastapi-service
#
# From a different namespace:
#   curl http://fastapi-service.fastapi-dev
#   curl http://fastapi-service.fastapi-dev.svc.cluster.local
#
# ==============================================================================
