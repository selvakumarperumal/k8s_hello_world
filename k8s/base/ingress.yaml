# ==============================================================================
# Kubernetes Ingress - FastAPI Hello World
# ==============================================================================
#
# WHAT IS AN INGRESS?
# -------------------
# Ingress exposes HTTP and HTTPS routes from outside the cluster to services
# within the cluster. Traffic routing is controlled by rules defined on the
# Ingress resource.
#
# PREREQUISITES:
# --------------
# An Ingress Controller must be installed (e.g., NGINX Ingress Controller)
# Install with: kubectl apply -k k8s/ingress-nginx/
#
# ==============================================================================

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: fastapi-ingress
  annotations:
    # NGINX-specific annotations
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    # SSL redirect (enable when TLS is configured)
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
spec:
  # Ingress class - must match installed controller
  ingressClassName: nginx

  # TLS configuration (uncomment and configure for HTTPS)
  # tls:
  #   - hosts:
  #       - api.example.com
  #     secretName: fastapi-tls

  # Routing rules
  rules:
    # Host-based routing (uncomment and set your domain)
    # - host: api.example.com
    - http:
        paths:
          # Route all traffic to FastAPI service
          - path: /
            pathType: Prefix
            backend:
              service:
                name: fastapi-service
                port:
                  number: 80
