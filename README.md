# FastAPI Hello World - Production-Grade Kubernetes Deployment

A complete DevOps infrastructure for deploying a FastAPI application on AWS EKS.

## ðŸš€ Technologies Used

| Technology | Purpose |
|------------|---------|
| **Docker** | Container runtime with multi-stage builds |
| **Kubernetes (EKS)** | Container orchestration on AWS |
| **Helm** | Kubernetes package management |
| **NGINX Ingress** | Ingress controller for external access |
| **GitHub Actions** | CI/CD pipelines |
| **Argo CD** | GitOps continuous deployment |
| **Prometheus + Grafana** | Monitoring and observability |
| **Terraform** | Infrastructure as Code |
| **Linkerd** | Service mesh for mTLS |

## ðŸ“ Project Structure

```
k8s_hello_world/
â”œâ”€â”€ app/                        # FastAPI application
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ bootstrap/              # Run LOCALLY first (S3 + DynamoDB)
â”‚   â”œâ”€â”€ backend.hcl             # Generated by bootstrap, commit to Git
â”‚   â”œâ”€â”€ main.tf                 # VPC, EKS, ECR (runs via GitHub Actions)
â”‚   â””â”€â”€ terraform.tfvars
â”œâ”€â”€ helm/fastapi-app/           # Helm chart
â”œâ”€â”€ argocd/                     # GitOps configuration
â”œâ”€â”€ monitoring/                 # Prometheus + Grafana
â”œâ”€â”€ service-mesh/               # Linkerd
â”œâ”€â”€ security/                   # Network policies, PSS
â”œâ”€â”€ .github/workflows/          # GitHub Actions (manual only)
â””â”€â”€ docs/                       # Documentation
```

## ðŸ Deployment Flow

```
1. Bootstrap (LOCAL)     â†’  Creates S3/DynamoDB, generates backend.hcl
2. Push backend.hcl      â†’  Commit to GitHub
3. Infrastructure (GHA)  â†’  Creates VPC, EKS, ECR
4. Build & Deploy (GHA)  â†’  Builds Docker, pushes to ECR
5. Argo CD               â†’  Syncs application to cluster
```

## ðŸ“‹ Step-by-Step Deployment

### Prerequisites

```bash
# Install required tools
aws configure                    # Configure AWS credentials
terraform --version              # Terraform >= 1.6
```

### Step 1: Bootstrap (Run Locally)

```bash
cd infrastructure/bootstrap
terraform init
terraform apply

# This creates:
# - S3 bucket for state storage
# - DynamoDB table for state locking
# - backend.hcl file (auto-generated)
```

### Step 2: Push to GitHub

```bash
git add infrastructure/backend.hcl
git commit -m "chore: Add backend.hcl from bootstrap"
git push origin main
```

### Step 3: Add GitHub Secrets

Go to **Settings â†’ Secrets and variables â†’ Actions** and add:

| Secret | Value |
|--------|-------|
| `AWS_ACCESS_KEY_ID` | Your AWS access key |
| `AWS_SECRET_ACCESS_KEY` | Your AWS secret key |

### Step 4: Run Infrastructure (GitHub Actions)

1. Go to **Actions â†’ Infrastructure**
2. Click **Run workflow**
3. Select `apply` and `dev`
4. Wait ~15-20 minutes

### Step 5: Build & Deploy (GitHub Actions)

1. Go to **Actions â†’ Build and Deploy**
2. Click **Run workflow**
3. Select `dev`

### Step 6: Install Cluster Components (CloudShell)

```bash
# Configure kubectl
aws eks update-kubeconfig --region ap-south-1 --name hello-world-dev-eks

# Install NGINX Ingress
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm install ingress-nginx ingress-nginx/ingress-nginx -n ingress-nginx --create-namespace

# Install Argo CD
kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# Deploy application via GitOps
kubectl apply -f argocd/projects/
kubectl apply -f argocd/applications/
```

## ðŸ“š Documentation

| Document | Description |
|----------|-------------|
| [COMPLETE_GUIDE.md](docs/COMPLETE_GUIDE.md) | Full architecture + deployment guide |
| [ARCHITECTURE.md](docs/ARCHITECTURE.md) | System design diagrams |
| [RUNBOOK.md](docs/RUNBOOK.md) | Operations and troubleshooting |

## ðŸ§¹ Cleanup

```bash
# 1. Destroy infrastructure (GitHub Actions)
# Actions â†’ Infrastructure â†’ destroy

# 2. Destroy bootstrap (locally)
cd infrastructure/bootstrap
terraform destroy
```

## ðŸ’° Cost Estimation

~$150-170/month for dev environment (Spot instances)
